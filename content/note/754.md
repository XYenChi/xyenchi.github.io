---
title: "IEEE 754"
draft: true
---

#### 5.12 浮点数和外部字符序的转换细节

在向最近偶数舍入的情况下，外部十进制字符序和原本的浮点表示应该可以互相转换和复原，除了 signaling NaN 可能会被转换成 quiet NaN。0变成1.   

##### 5.12.1 外部字符序表示 0、无穷和NaNs
无限 inf infinity 有正负。   

quiet NaN 可选提供符号（标准不解释 NaN 的符号）   

signaling NaN 应产生 “snan” 或 “nan” 或其他等价异常，可选提供符号。如果 signaling NaN 产生“nan”或其他等价异常，会发出无效操作异常信号。   
原来产不产生 “snan” 是有区别的吗？   

有可选前置符号的外部字符序“snan”要么产生 signaling NaN，要么产生 quiet NaN 并发出无效操作异常信号。   

语言标准应提供可选支持格式的 NaNs 到外部字符序的转换。外部字符序在基本的 NaN 字符拼接后缀表示 NaN 的诊断信息。   

##### 6.2.1 NaN 的二进制编码

所有二进制 NaN 的偏置指数位是全1。   

A ***quiet NaN*** bit string should be encoded with the first bit(d1) of the trailing significand field T being 1.   
A ***signaling NaN*** bit string should be encoded with the first bit of the trailing significand field being 0.   
quiet NaN 和 signal NaN 的区别是T区域的第一位，quiet 是1，signal是0。0有话要说。   
如果 T 区第一位已经是0了，那么其他位需要非0，来区分无限和 NaN   

##### 6.2.3 NaN 传播

目标格式如果可以表示 NaN 的 payload 且输入数据中有一个 NaN，那就应该表示出来。   
相同底数的 quiet NaN 从更窄的格式转换到更宽的格式，再转换回更窄的格式，不应该以任何形式修改 quiet NaN payload 除非使之合法化。   
quiet NaN 转换到相同或不同底数但不允许保留 payload 应返回保留语言定义诊断信息的 quiet NaN。   

#### 6.3 符号位
bit strings 操作：copy、negate、abs、copySign 指定 NaN 结果的符号位。
logical predicate totalOrder 也会被 NaN 操作数的符号位影响。   
所有其他操作，***754 不指定 NaN 结果的符号位*** ，即使只有一个输入是 NaN，或者 NaN 从无效操作中产生。   
除了 squareRoot(-0) = -0 之外，每个平方根的结果都应有正号。   
### 7. 默认异常处理
#### 7.1 概览：异常和标志位
本条指定五种出现时应发出信号的异常；调用默认或其他可选的处理方式来处理信号异常。实现应提供对应异常的状态标志位。   

Exceptions are handled without raising status flags only:   
1.exact underflow.   
2.status flags are raised without an exception being signaled only at the user's request.   
#### 7.2 无效操作
无效操作异常当且仅当***没有可用（useful）可定义（definable）的结果***时发出。   

默认产生提供诊断信息的 quiet NaN 的操作：   

结果是浮点，发出无效操作异常：   
a)  任何一般运算或者 signaling NaN 的信号操作   
b)  乘法：0和无穷，无穷和0   
c)  fusedMultiplyAdd:fusedMultiplyAdd(0,∞,c) or fusedMultiplyAdd(∞,0,c),除非 c 是 quiet NaN；如果 c 是 quiet NaN，是否发出无效操作异常将由实现定义   
d)  加、减、混合乘加：magnitude subtraction of infinities，such as: addition(+∞, -∞)。中文输入法输入无穷可以选∞符号，英文输入法咋打呢。   
e)  除：division(0,0)或 division(∞,∞)   
f)  取余：remainder(x,y)，当 y 是0或 x 是无穷且没有一个是 NaN。   
g)  平方根，如果操作数小于0。   
h)  量化，当结果不符合目标格式或者其中一个操作数有限另一个无限。   

结果不是浮点的操作，发出无效操作异常的操作：   
i)  浮点转换为整型，源操作数是 NaN、无穷或转换成整型在生效的舍入属性下超出了范围   
j)  unordered-signaling predicates 前略后略，要用的时候再看   
k)  logB(NaN)前略后略，要用的时候再看   

#### 7.3 除零
当且仅当操作数有限，结果无限时，发出除零异常。   
—— 除法，除数是0，被除数是非零有限数，无限的符号异或操作数符号。   
—— logB(0) 当 logBFormat 是浮点格式时，无限的符号是负。   

#### 7.4 溢出
当切仅当目标格式最大有限数字超过了指数范围无限的舍入浮点结果的大小。   
这是什么长句阅读理解吗？？？   
中文比英文还难看懂。   
The overflow exception shall be signaled if and only if the destination format's largest finite number is exceeded in magnitude by what would have been the rounded floating-point result were the exponent range unbounded.   
默认结果由舍入方向和中间结果的符号决定，如下：   
a)  向最近偶数摄入和向绝对值更大方向舍入把所有溢出带到∞，保留中间结果的符号。   
b)  向0舍入带入所有溢出到该格式的最大有限数值，保留中间结果的符号。   
c)  向负无穷舍入将所有正号溢出限制在该格式的最大有限数值，负向溢出到-∞。   
d)  向正无穷舍入将所有负号溢出限制在该格式的最小有限数值，正向溢出到+∞。   
此外，溢出的默认异常处理中，会标记溢出并发出非精确异常。   

#### 7.5 下溢
发现小但非零的结果时，应发出下溢异常。对于二进制格式来说：   
a)  舍入之后——非零结果
b)  舍入之前